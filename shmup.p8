pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include waves.p8
#include explosionlogic.p8
#include draw.p8
#include update.p8

-- todo: can you do different colors based on speed, fast moving stars become lines, and multiple bullets?
-- next: https://www.youtube.com/watch?v=2httrC7c1m0&ab_channel=LazyDevs
-- change enemy sprite when hit/explosion
function _init()
 	cls(0)
	mode="start"
	blinkt=1
	t=0
	bultimer=0
	splashcnt=0
	wavetime=70
	lockout=0
end
-- update to account for using the drawspr for the ship.
-- using the improved loop
-- spawn multiple enemies (try 5 or 10 over time)
-- Different types of enemies
function start_game()
	-- enemies
	enemies={}
	wave=0
	t=0
	mode="splash"	
	
	--ship vars
	ship=make_spr()
	ship.x=80
	ship.y=80
	ship.spr=17
	
	--bullet vars
	bulx=-10
	buly=-10
	bulspr=5
	
	--muzzle
	muzzle=0
	
	--game state
	score=0
	lives=4
	invul=0
	bombs=2

	attacfreq=60

	--star mapping
	stars={}
	
	for i=1,100 do
		local newstar=make_spr()
		newstar.x=flr(rnd(128))
		newstar.y=flr(rnd(128))
		newstar.spd=rnd(1.5)+0.5
		add(stars,newstar)
	end
	
	-- bullets
	buls={}
	ebuls={}

	-- explosions
	explosionarr={}
	-- particles
	parts={}
	shwaves={}
	
	nextwave()
end

function starfield()
	for i=1,#stars do
		starcolor=7
		if (i%2==0) then
			starcolor=10
		end
		pset(stars[i].x,stars[i].y,starcolor)
	end
end

function animatestars()
	for i=1,#stars do
		local mystar=stars[i]
		mystar.y=mystar.y+mystar.spd
		if mystar.y>128 then
			mystar.y=mystar.y-128
		end
	end
end

function blink()
	local banim={5,5,6,6,7,7,6,6,5,5}

	if blinkt > #banim then 
		blinkt=1
	end
	return banim[blinkt]
end

function drawspr(myspr)
	local sprx=myspr.x
	local spry=myspr.y

	if myspr.shake>0 then
		myspr.shake-=1
		if t%4<2 then
			sprx+=1
		end
		sprx+=abs(sin(t/2.5)*1.5)
	end

	if myspr.bulmode then
		sprx-=2
		spry-=2
	end
	spr(myspr.spr,sprx,spry,myspr.sprw,myspr.sprh)
end

function col(a,b)
	local a_left=a.x
	local a_top=a.y
	local a_right=a.x+a.colw-1
	local a_bottom=a.y+a.colh-1

	local b_left=b.x
	local b_top=b.y
	local b_right=b.x+b.colw-1
	local b_bottom=b.y+b.colh-1

	if a_top >b_bottom then return false end
	if b_top >a_bottom then return false end
	if a_left >b_right then return false end
	if b_left >a_right then return false end	

	return true
end

__gfx__
00000000000000000099990000000000000000000009900000000000077777700000000000000000000000000880088008800880000000000000000000000000
0000000000000000099a9990000cc00080777708009aa90007000070778888770088880000000000000000008888888880088008000000000000000000000000
007007000700007099a9999900c11c0008777780009aa90070700707788778870807708000000000000000008888888880000008000000000000000000000000
00077000007007009a99999900c11c000787787009aaaa9008077080788778870870078000000000000000008888888880000008000000000000000000000000
0007700000800800999999990cc11cc00777777009aaaa9070788707788778870870078000000000000000000888888008000080000000000000000000000000
007007000000000099999999cccccccc07777770090aa09007077070078888700807708000000000000000000088880000800800000000000000000000000000
000000000700070009999990c000000c070770700009900000077000007887000088880000000000000000000008800000088000000000000000000000000000
00000000007770000099990000000000000000000000000000000000000770000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000080000008000000000000000000000000000000000087000000870000000000000000000000000000
000c1000000cc0000001c00000000000007777008077770880777708807777080000000000000000000000000000700000007000000000000000000000000000
0011c10000c11c00001c110000000000087777800877778008777780087777800000000000000000000000000088880000888800000000000000000000000000
0011c10000c11c00001c110000000000078778700787787007877870078778700000000000000000000000000880888008070080000000000000000000000000
0c77cc100cc77cc001cc77c000000000077777700777777007777770077777700000000000000000000000000808888008700080000000000000000000000000
0cccccc1cccccccc1cccccc000000000077777700777777007777770077777700000000000000000000000000888888008000080000000000000000000000000
0c0990c1c009900c1c0990c000000000070770700707707007077070070770700000000000000000000000000888888008000080000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088880000888800000000000000000000000000
00ee000000ee00000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e22e0000e88e00007cc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e2e82e00e87e8e007c77c70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e2882e00e8ee8e007c77c70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e22e0000e88e00007cc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00ee000000ee00000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000555505555500000055550555550000000555050000000000000000000000000000000000000000000000000000000
00007000700000000000799999900000005665656566550000566565656655000000000000000000000000000000000000000000000000000000000000000000
000000000000700000099aaaaaa97000056888888886650005555555559665000000000000000000000000000000000000000000000000000000000000000000
000099000900000000099aaaaaaa9000556899999988865055655855855996505500000000000050000000000000000000000000000000000000000000000000
0000aaa99a000000009aaaa77aaaa9005689aaa99a9988655669aaa8555955655605556600006665000000000000000000000000000000000000000000000000
0000aa7aaaaa0000009aaa77777aa9005689aa7aaaaa9865566555558a5555655605556655556600000000000000000000000000000000000000000000000000
0000a77777a90000009aa777777aa9005689aa777aa998655655aa55585559655005550055555000000000000000000000000000000000000000000000000000
0000a77777a00000009aa77777aaa9005899aa77aaa9886558858599898589655000066655555000000000000000000000000000000000000000000000000000
00000a7a77a00000009aaa7a777aa9005689aaaaaaa9865556655558558996555006666655555000000000000000000000000000000000000000000000000000
0000070aa00000000099aaaaa7aaa90056899aaaaa99855056659a558a9595505006666655555000000000000000000000000000000000000000000000000000
000070000070000000099aaaaaaa9000568999999998550056699999555555005006665500000000000000000000000000000000000000000000000000000000
0007000000000000000799aaaa990000056888888886650005555aa55aa665000000055500000000000000000000000000000000000000000000000000000000
00000000000000000000099999990000056565556565500005656555656550000000055500000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000005550005050000000555000505000000055500050500000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000070000020000200200002002000020020000205555555555555555555555555555555502222220022222200222222002222220
000bb000000bb0000007700000077000022ff220022ff220022ff220022ff2200578875005788750d562465d0578875022e66e2222e66e2222e66e2222e66e22
0066660000666600606666066066660602ffff2002ffff2002ffff2002ffff2005624650d562465d05177150d562465d27761772277617722776177227716772
0566665065666656b566665bb566665b0077d7000077d700007d77000077d700d517715d051771500566865005177150261aa172216aa162261aa612261aa162
65637656b563765b056376500563765008577580085775800857758008577580056686500566865005d24d50056686502ee99ee22ee99ee22ee99ee22ee99ee2
b063360b006336000063360000633600080550800805508008055080080550805d5245d505d24d500505505005d24d5022299222229999222229922222299222
006336000063360000633600006336000c0000c007c007c007c00c7007c007c05005500505055050050000500505505020999902020000202099990202999920
0006600000066000000660000006600000c7c7000007c0000077cc000007c000dd0000dd0dd00dd005dddd500dd00dd022000022022002202200002202200220
00ff880000ff88000000000000000000200000020200002000000000000000003350053303500530000000000000000000000000000000000000000000000000
0888888008888880000000000000000022000022220000220000000000000000330dd033030dd030005005000350053000000000000000000000000000000000
06555560076665500000000000000000222222222222222200000000000000003b8dd8b3338dd833030dd030030dd03003e33e300e33e330033e333003e333e0
6566665576555565000000000000000028222282282222820000000000000000032dd2300b2dd2b0038dd830338dd833e33e33e333e33e333e33e333e33e333e
57655576555776550000000000000000288888822888888200000000000000003b3553b33b3553b3033dd3300b2dd2b033300333333003333330033333300333
0655766005765550000000000000000028788782287887820000000000000000333dd333333dd33303b55b303b3553b3e3e3333bbe33333ebe3e333be3e3333b
0057650000655700000000000000000028888882080000800000000000000000330550330305503003bddb30333dd3334bbbbeb44bbbebb44bbbbeb44bbbebe4
00065000000570000000000000000000080000800000000000000000000000000000000000000000003553000305503004444440044444400444444004444440
0066600000666000006660000068600000888000002222000022220000222200002222000cccccc00c0000c00000000000000000000000000000000000000000
055556000555560005585600058886000882880002eeee2002eeee2002eeee2002eeee20c0c0c0ccc000000c0000000000000000000000000000000000000000
55555560555855605588856058828860882228802ee77ee22ee77ee22eeeeee22ee77ee2c022220ccc2c2c0cc022220c00222200000000000000000000000000
55555550558885505882885088222880822222802ee77ee22ee77ee22ee77ee22ee77ee2cc2cac0cc02aa20cc0cac2ccc02aa20c000000000000000000000000
15555550155855501588855018828850882228802eeeeee22eeeeee22eeeeee22eeeeee2c02aa20cc0cac2ccc02aa20ccc2cac0c000000000000000000000000
01555500015555000158550001888500088288002222222222222222222222222222222200222200c022220ccc2c2c0cc022220c000000000000000000000000
0011100000111000001110000018100000888000202020200202020220202020020202020000000000000000c000000cc0c0c0cc000000000000000000000000
00000000000000000000000000000000000000002000200002000200002000200002000200000000000000000c0000c00cccccc0000000000000000000000000
000880000009900000089000000890000000000001111110011111100000000000d89d0000189100001891000019810000005500000050000005000000550000
706666050766665000676600006656000000000001cccc1001cccc10000000000d5115d000d515000011110000515d0000055000000550000005500000055000
1661c6610161661000666600001666000000000001cccc1001cccc1000000000d51aa15d0151a11000155100011a151005555550055555500555555005555550
7066660507666650006766000066560000000000017cc710017cc71000000000d51aa15d0d51a15000d55d00051a15d022222222222222222222222222222222
0076650000766500007665000076650000000000017cc710017cc710000000006d5005d6065005d0006dd6000d50056026060602260606022666666226060602
000750000007500000075000000750000000000001111110011111100000000066d00d60006d0d600066660006d0d60020000002206060622222222020606062
00075000000750000007500000075000000000001100001101100110000000000760067000660600000660000060660020606062222222200000000022222220
00060000000600000006000000060000000000001100001101100110000000000070070000070700000770000070700022222220000000000000000000000000
0007033000700000007d330003330333000000000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000
000d3300000d33000028833003bb3bb3000000000888882000000000000000000000000000000000000000000000000000000000000000000000000000000000
0778827000288330071ffd1000884200002882000888882000288200000000000000000000000000000000000000000000000000000000000000000000000000
071ffd10077ffd700778827008ee8e800333e33308ee8e80088ee883000000000000000000000000000000000000000000000000000000000000000000000000
00288200071882100028820008ee8e8003bb4bb308ee8e8008eeee83000000000000000000000000000000000000000000000000000000000000000000000000
07d882d00028820007d882d00888882008eeee800088420008eeee80000000000000000000000000000000000000000000000000000000000000000000000000
0028820007d882d000dffd0008888820088ee88003bb3bb3088ee880000000000000000000000000000000000000000000000000000000000000000000000000
00dffd0000dffd000000000000222200002882000333033300288200000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000149aa94100000000012222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00019777aa921000000029aaaa920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d09a77a949920d00d0497777aa920d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0619aaa9422441600619a77944294160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07149a922249417006149a9442244160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07d249aaa9942d7006d249aa99442d60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
067d22444422d760077d22244222d770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d666224422666d00d776249942677d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
066d51499415d66001d1529749251d10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0041519749151400066151944a151660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00a001944a100a0000400149a4100400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000049a400090000a0000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000037050360503405033050310502f050330502b05029050290502605023050220501f05016050190500405017050150500f0500c0500905006050020500105000000000010000000000010000500004000
00030000316302e6302b630236302662021620226201b6201d6201963016630126300462001620000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000256500c6500a6501a650126500e6500865004650026500065000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000121201b120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
